---
id: introduction
title: Tanstack React Query
sidebar_label: Tanstack React Query (⭐️)
description: Tanstack React Query
slug: /client/tanstack-react-query/introduction
---

Compared to our [classic React Query Integration](/docs/client/react) this client is simpler and more Tanstack Query-native, providing factories for common Tanstack React Query interfaces like QueryKeys, QueryOptions, and MutationOptions. We think it's the future and recommend using this over the classic client

## Setup

### 1. Install dependencies

The following dependencies should be installed

import { InstallSnippet } from '@site/src/components/InstallSnippet';

<InstallSnippet pkgs="@trpc/server@next @trpc/client@next @trpc/tanstack-react-query@next @tanstack/react-query@latest" />

### 2. Import your `AppRouter`

```twoslash include router
// @filename: server/router.ts
import { initTRPC } from '@trpc/server';
import { z } from "zod";
const t = initTRPC.create();

const appRouter = t.router({
  getUser: t.procedure.input(z.object({ id: z.string() })).query(() => ({ name: 'foo' })),
  createUser: t.procedure.input(z.object({ name: z.string() })).mutation(() => 'bar'),
});
export type AppRouter = typeof appRouter;
```

import ImportAppRouter from '../../partials/_import-approuter.mdx';

<ImportAppRouter />

### 3. Create tRPC hooks

Create a set of strongly-typed React hooks from your `AppRouter` type signature with `createTRPCReact`.

```ts twoslash title='utils/trpc.ts' include utils
// @include: router
// @filename: utils/trpc.ts
// ---cut---
import { createTRPCContext } from '@trpc/tanstack-react-query';
import type { AppRouter } from '../server/router';

export type { AppRouter };

const { TRPCProvider, useTRPC } = createTRPCContext<AppRouter>();

export { TRPCProvider, useTRPC };
```

### 4. Add tRPC providers

Create a tRPC client, and wrap your application in the tRPC Provider, as below. You will also need to set up and connect React Query, which [they document in more depth](https://tanstack.com/query/latest/docs/framework/react/quick-start).

:::tip
If you already use React Query in your application, you **should** re-use the `QueryClient` and `QueryClientProvider` you already have.
:::

```tsx title='App.tsx'
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { createTRPCClient, httpBatchLink } from '@trpc/client';
import React, { useState } from 'react';
import { queryClient, trpcClient, TRPCProvider, useTRPC } from './utils/trpc';

export function App() {
  const [queryClient] = useState(() => new QueryClient());
  const [trpcClient] = useState(() =>
    createTRPCClient<AppRouter>({
      links: [
        httpBatchLink({
          url: 'http://localhost:2022',
        }),
      ],
    }),
  );

  return (
    <QueryClientProvider client={queryClient}>
      <TRPCProvider trpcClient={trpcClient} queryClient={queryClient}>
        // Your app here
      </TRPCProvider>
    </QueryClientProvider>
  );
}
```

The reason for using `useState` in the creation of the `queryClient` and the `TRPCClient`, as opposed to declaring them outside of the component, is to ensure that each request gets a unique client when using SSR. If you use client side rendering then you could create them as singletons.

#### 5. Fetch data

You can now use the tRPC React Query integration to call queries and mutations on your API.

```tsx title='Users.tsx'
import { useMutation, useQuery } from '@tanstack/react-query';
import { useTRPC } from './utils/trpc';

export default function Users() {
  const trpc = useTRPC();
  const userQuery = useQuery(trpc.getUser.queryOptions({ id: 'id_bilbo' }));
  const userCreator = useMutation(trpc.createUser.mutationOptions());

  return (
    <div>
      <p>{userQuery.data?.name}</p>

      <button onClick={() => userCreator.mutate({ name: 'Frodo' })}>
        Create Frodo
      </button>
    </div>
  );
}
```

## Usage

The philosophy of this client is to provide factories which work natively and type-safely with tanstack React Query. This means just by following the autocompletes the client gives you, you can focus on building just with the knowledge the [Tanstack React Query docs](https://tanstack.com/query/latest/docs/framework/react/overview) provide.

```tsx
export default function Basics() {
  const trpc = useTRPC();

  // Create QueryOptions which can be passed to useQuery,
  // useSuspenseQuery, useInfiniteQuery
  trpc.path.to.query.queryOptions({ /** inputs */ })

  // Create MutationOptions which can be passed to useMutation
  trpc.path.to.mutation.mutationOptions()

  // Create QueryKey which can be used to manipulated many methods
  // on Tanstack's QueryClient in a type-safe manner
  trpc.path.to.query.queryKey()

  return (
    // Your app here
  )
}
```

## Subscriptions

Tanstack does not provide a subscription hook, so we continue to expose our own abstraction here which works with a [standard tRPC subscription setup](/docs/server/subscriptions)

```tsx title='App.tsx'
import {
  createTRPCClient,
  httpBatchLink,
  splitLink,
  unstable_httpSubscriptionLink,
} from '@trpc/client';

// Modify your links to include a subscription link
createTRPCClient<AppRouter>({
  links: [
    splitLink({
      condition: (op) => op.type === 'subscription',
      true: unstable_httpSubscriptionLink({
        url: 'http://localhost:3000',
        transformer,
      }),
      false: httpBatchLink({
        url: 'http://localhost:3000',
        transformer,
      }),
    }),
  ],
});
```

```tsx title='SubscriptionExample.tsx'
function SubscriptionExample() {
  const trpc = useTRPC();
  const subscription = useSubscription(trpc.path.to.subscription.subscriptionOptions(
    {
      onData: (data) => {
        // you can handle the data here
      },
    }
  ));

  // Or you can handle the data here
  subscription.data

  return (
    // Your app here
  );
}
```
